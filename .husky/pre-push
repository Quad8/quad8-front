#!/bin/sh

# ê¸ˆì§€ëœ ì €ì¥ì†Œ URLê³¼ ë¸Œëœì¹˜
FORBIDDEN_HTTPS_URL="https://github.com/Quad8/quad8-front.git"
FORBIDDEN_SSH_URL="git@github.com/Quad8/quad8-front.git"
FORBIDDEN_REF_MAIN="refs/heads/main"
FORBIDDEN_REF_DEV="refs/heads/develop"

remote="$1"
url="$2"

if [ "$url" != "$FORBIDDEN_HTTPS_URL" ] && [ "$url" != "$FORBIDDEN_SSH_URL" ]; then
    echo "ğŸŒŸ Forked branch can push your commits ğŸŒŸ"
    exit 0 # í¬í¬ëœ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì œí•œí•˜ì§€ ì•ŠìŒ
fi

while read -r local_ref local_sha remote_ref remote_sha; do
  echo "ğŸš€ í˜„ì¬ í‘¸ì‰¬í•˜ëŠ” ë¸Œëœì¹˜ëŠ” $local_ref ì…ë‹ˆë‹¤. ğŸš€"
    if [ "$remote_ref" = "$FORBIDDEN_REF_MAIN" ] || [ "$remote_ref" = "$FORBIDDEN_REF_DEV" ]; then
        echo "ğŸ›‘ DO NOT PUSH TO MAIN OR DEV ğŸ›‘"
        exit 1 # ê¸ˆì§€ëœ refë¡œ pushë¥¼ ì‹¤í–‰í•˜ë©´ ì—ëŸ¬
    fi
done

# ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  ì‹¤íŒ¨í•˜ë©´ í‘¸ì‰¬ë¥¼ ì¤‘ë‹¨í•©ë‹ˆë‹¤.
echo "âœ¨ Running npm build... âœ¨"
if ! npm run build; then
    echo "âŒ Build failed. Push aborted. âŒ"
    exit 1
fi

echo "âœ… Build succeeded. Proceeding with push. âœ…"

exit 0